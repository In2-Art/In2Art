"use strict";(self.webpackChunkWebAppNew=self.webpackChunkWebAppNew||[]).push([[582],{5219:(y,I,i)=>{i.d(I,{T:()=>e});var O=i(5861),t=i(4650),c=i(6345),M=i(6895);function N(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275i18n(1,3),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275i18nExp(n.text||n.nomText+" is required"),t.\u0275\u0275i18nApply(1)}}function T(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275i18n(1,4),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275i18nExp(n.nomText)(n.control.errors.minlength.actualLength)(null==n.control.errors?null:n.control.errors.minlength.requiredLength),t.\u0275\u0275i18nApply(1)}}function R(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275i18n(1,5),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275i18nExp(n.nomText)(n.control.errors.maxlength.actualLength)(null==n.control.errors?null:n.control.errors.maxlength.requiredLength),t.\u0275\u0275i18nApply(1)}}function C(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275i18n(1,6),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275i18nExp(n.nomText),t.\u0275\u0275i18nApply(1)}}function v(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1("",n.nomText," already exists")}}function h(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275i18n(1,7),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275i18nExp(n.nomText),t.\u0275\u0275i18nApply(1)}}function x(_,s){if(1&_&&(t.\u0275\u0275elementStart(0,"div"),t.\u0275\u0275template(1,N,2,1,"div",1),t.\u0275\u0275template(2,T,2,3,"div",1),t.\u0275\u0275template(3,R,2,3,"div",1),t.\u0275\u0275template(4,C,2,1,"div",1),t.\u0275\u0275template(5,v,2,1,"div",1),t.\u0275\u0275template(6,h,2,1,"div",1),t.\u0275\u0275elementEnd()),2&_){const n=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.required),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.minlength),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.maxlength),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.email),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.notUnique),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.pattern)}}let e=(()=>{class _{constructor(n){this.main=n}ngOnInit(){var n=this;return(0,O.Z)(function*(){console.log("Control: ",n.control)})()}}return _.\u0275fac=function(n){return new(n||_)(t.\u0275\u0275directiveInject(c.J))},_.\u0275cmp=t.\u0275\u0275defineComponent({type:_,selectors:[["app-missatge-error-form"]],inputs:{control:"control",text:"text",nomText:"nomText"},decls:1,vars:1,consts:function(){let s,n,f,F,S;return s="" + "\ufffd0\ufffd" + "",n="" + "\ufffd0\ufffd" + " is too short (" + "\ufffd1\ufffd" + "/" + "\ufffd2\ufffd" + ")",f="" + "\ufffd0\ufffd" + " is too long (" + "\ufffd1\ufffd" + "/" + "\ufffd2\ufffd" + ")",F="" + "\ufffd0\ufffd" + " has a wrong format",S="" + "\ufffd0\ufffd" + " has a wrong format",[[4,"ngIf"],["class","textErrorForm",4,"ngIf"],[1,"textErrorForm"],s,n,f,F,S]},template:function(n,f){1&n&&t.\u0275\u0275template(0,x,7,6,"div",0),2&n&&t.\u0275\u0275property("ngIf",null==f.control?null:f.control.touched)},dependencies:[M.NgIf]}),_})()},5582:(y,I,i)=>{i.r(I),i.d(I,{EditProfileModule:()=>W});var O=i(6895),t=i(1670),c=i(4006),M=i(5861),N=i(1274),T=i(5009),R=i(4756),C=i(872),v=i(4004),h=i(7873),x=i(2217),e=i(4650),_=i(6345),s=i(7753),n=i(1481),f=i(9653),F=i(8291),S=i(6362),P=i(5219);const L=["uploadFileModal"],D=["imageCropper"];function $(l,m){if(1&l&&e.\u0275\u0275element(0,"video",39),2&l){const o=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("src",o.form.controls.photo.value,e.\u0275\u0275sanitizeUrl)}}function G(l,m){if(1&l&&e.\u0275\u0275template(0,$,1,1,"video",38),2&l){const o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngIf",!o.mostrarComoImagen)}}function w(l,m){if(1&l&&e.\u0275\u0275element(0,"img",40),2&l){const o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("src",o.form.controls.photo.value,e.\u0275\u0275sanitizeUrl)}}function z(l,m){if(1&l){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",41),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.removePhoto())}),e.\u0275\u0275i18n(1,42),e.\u0275\u0275elementEnd()}}function U(l,m){if(1&l){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",14)(1,"div",15)(2,"button",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.openUploadFileModal())}),e.\u0275\u0275template(3,G,1,1,"ng-template",null,17,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(5,w,1,1,"img",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"br"),e.\u0275\u0275template(7,z,2,0,"button",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",20)(9,"label",21),e.\u0275\u0275i18n(10,22),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"input",23)(12,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",20)(14,"label",25),e.\u0275\u0275i18n(15,26),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(16,"input",27)(17,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",20)(19,"label",25),e.\u0275\u0275i18n(20,28),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(21,"input",29)(22,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"div",20)(24,"label",25),e.\u0275\u0275i18n(25,30),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(26,"input",31)(27,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"div",20)(29,"label",25),e.\u0275\u0275i18n(30,32),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(31,"input",33)(32,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",20)(34,"label",25),e.\u0275\u0275i18n(35,34),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(36,"input",35)(37,"app-missatge-error-form",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"div",36)(39,"input",37),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275elementEnd()()()}if(2&l){const o=e.\u0275\u0275reference(4),r=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",r.form),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",r.mostrarComoImagen)("ngIfElse",o),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",r.form.controls.photo.value),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",r.form.controls.name.value)("nomText","name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",r.form.controls.lastName.value)("nomText","last name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",r.form.controls.bio.value)("nomText","bio"),e.\u0275\u0275advance(4),e.\u0275\u0275attribute("disabled",!!r.inputDeshabilitado||null),e.\u0275\u0275advance(1),e.\u0275\u0275property("control",r.form.controls.email.value)("nomText","email"),e.\u0275\u0275advance(4),e.\u0275\u0275attribute("disabled",!!r.inputDeshabilitado||null),e.\u0275\u0275advance(1),e.\u0275\u0275property("control",r.form.controls.username.value)("nomText","username"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",r.form.controls.web.value)("nomText","website"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!r.form.dirty&&!r.fotoModificada)}}function X(l,m){1&l&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275element(1,"app-loading"),e.\u0275\u0275elementEnd())}let B=(()=>{class l{constructor(o,r,a,d,g){this.main=o,this.fb=r,this.modalService=a,this.domSanitizer=d,this.store=g,this.files=[],this.validate=!1,this.fotoModificada=!1,this.mostrarComoImagen=!1,this.inputDeshabilitado=!0,this.mostrarFileRequired=!1,o.newPage(this),this.form=this.fb.group({id:[""],photo:[""],name:[""],lastName:[""],bio:[""],email:[""],username:[""],phone:[""],address:[""],web:[""]}),this.$user=this.store.select(h.dy).pipe((0,v.U)(p=>p.user)),this.$user.subscribe(p=>{this.ownUser=p})}ngOnInit(){var o=this;return(0,M.Z)(function*(){console.log("Own user: ",o.ownUser.userId);let r=o.ownUser.userId;o.carregant=!0;try{const a=yield T.Iw.getById(r),d=o.ownUser;console.log("Usuari edit-profile:",a.data),console.log("log user: ",d),console.log("Photo: ",C.pz.getUrlImageThumbnail({pictureId:d.photo,id:d.userId})),o.form.controls.photo.setValue(C.pz.getUrlImageThumbnail({pictureId:d.photo,id:d.userId})),o.form.controls.name.setValue(a.data.name||""),o.form.controls.bio.setValue(a.data.languages[0].biography||""),o.form.controls.username.setValue(d.nickname||""),o.form.controls.web.setValue(a.data.languages[0].website||"")}catch(a){console.error("Error al obtener los datos del usuario:",a)}finally{o.carregant=!1}})()}ngOnDestroy(){this.closeUploadFileModal(!1),this.main.onDestroyPage()}openUploadFileModal(){this.modalService.open(this.uploadFileModal,{size:"lg",modalClass:"uploadFileModal",backdropClass:"modal-backdrop",hideCloseButton:!1,centered:!0,backdrop:!0,animation:!0,keyboard:!0,closeOnOutsideClick:!1})}closeUploadFileModal(o){console.log("Cerrando modal con saved=",o),o&&(this.form.controls.photo.setValue(this.imageCropper.croppedImage),this.fotoModificada=!0),this.modalService.close(this.uploadFileModal)}removePhoto(){this.form.controls.photo.setValue(null),this.imageCropper.removePhoto(),this.fotoModificada=!0}uploadPhoto(){var o=this;return(0,M.Z)(function*(){o.fotoModificada=!0,o.fotoModificada&&(console.log("foto modificada"),o.form.controls.photo.setValue(o.imageCropper.croppedImage),o.mostrarComoImagen=!0,o.modalService.close(o.uploadFileModal),console.log(o.form.controls.photo.value))})()}submit(){var o=this;return(0,M.Z)(function*(){if(o.form.markAllAsTouched(),o.mostrarFileRequired=!N.c.objPle(o.files),o.fotoModificada=!0,!o.form.valid)return console.log("--- INV\xc0LID ---"),void console.log("Form error!: ",o.form);const r=new FormData;let a;if(o.fotoModificada){var d=o.imageCropper.croppedImage;d&&d.includes("base64,")?(a={dataBase64:d.substr(d.indexOf("base64,")+7),fileName:"userProfile",fileExt:o.main.getStringBetween(d,"data:image/",";base64,")},console.log(a)):(console.log("La foto no fue modificada o blobStr no contiene informaci\xf3n v\xe1lida"),a=null)}r.append("name",o.form.controls.name.value),r.append("lastName",o.form.controls.lastName.value),r.append("bio",o.form.controls.bio.value),r.append("web",o.form.controls.web.value);let g=new T.Iw({photo:a||null,name:o.form.controls.name.value||null,nickname:o.form.controls.username.value||null});console.log("allNewInfo: ",g);try{yield T.Iw.put(g).then(function(){var p=(0,M.Z)(function*(E){E.IsOk?(console.log("OK. Message:",E),o.store.dispatch((0,x.Nq)({user:yield R.Pe.newCurrentUser()})),yield R.Pe.newCurrentUser(),o.main.goToProfile(),o.main.toastSuccess("Els canvis s'han canviat correctament"),o.form.markAsPristine(),o.mostrarComoImagen=!1):(console.error("Error. Message:",E),o.main.toastDanger("No s'ha pogut canviar les teves dades"))});return function(E){return p.apply(this,arguments)}}())}catch(p){console.error("Error:",p)}o.carregantSave=!0})()}}return l.\u0275fac=function(o){return new(o||l)(e.\u0275\u0275directiveInject(_.J),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(s.gk),e.\u0275\u0275directiveInject(n.H7),e.\u0275\u0275directiveInject(f.yh))},l.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["app-edit-profile"]],viewQuery:function(o,r){if(1&o&&(e.\u0275\u0275viewQuery(L,5),e.\u0275\u0275viewQuery(D,5)),2&o){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(r.uploadFileModal=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(r.imageCropper=a.first)}},decls:21,vars:3,consts:function(){let m,o,r,a,d,g,p,E,b;return m="Cancela",o="Confirma",r="Name",a="Last name",d="Bio",g="Email",p="Username",E="Website",b="Remove photo",[[1,"content"],[1,"card"],[1,"card-body"],["class","theme-form",3,"formGroup",4,"ngIf"],["class","carregant",4,"ngIf"],["id","uploadFileModal",1,"uploadFileModal"],["uploadFileModal",""],["id","label"],["imageCropper",""],["id","buttons"],[1,"boto","botoPrincipal","botoGran",3,"click"],m,[1,"boto","botoPrincipal","botoGran",3,"disabled","click"],o,[1,"theme-form",3,"formGroup"],[1,"divBotoFoto","form-grup"],["data-content","Change photo",1,"botoFoto",3,"click"],["videoBlock",""],["class","foto","alt","profile_img",3,"src",4,"ngIf","ngIfElse"],["class","boto botoVermell botoPetit removePhoto",3,"click",4,"ngIf"],[1,"form-grup","row","no-gutters"],[1,"col-form-label","col-sm-12","col-xl-3","asterisc"],r,["type","text","formControlName","name",1,"form-camp","col-sm-12","col-xl-9"],[3,"control","nomText"],[1,"col-form-label","col-sm-12","col-xl-3"],a,["type","text","formControlName","lastName",1,"form-camp","col-sm-12","col-xl-9"],d,["type","text","maxlength","3000","formControlName","bio",1,"form-camp","col-sm-12","col-xl-9"],g,["type","text","formControlName","email",1,"form-camp","col-sm-12","col-xl-9"],p,["type","text","formControlName","username",1,"form-camp","col-sm-12","col-xl-9"],E,["type","text","formControlName","web",1,"form-camp","col-sm-12","col-xl-9"],[2,"text-align","center"],["type","button","value","Save",1,"boto","botoPrincipal","botoGran",3,"disabled","click"],["class","foto",3,"src",4,"ngIf"],[1,"foto",3,"src"],["alt","profile_img",1,"foto",3,"src"],[1,"boto","botoVermell","botoPetit","removePhoto",3,"click"],b,[1,"carregant"]]},template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,U,40,19,"form",3),e.\u0275\u0275template(4,X,2,0,"div",4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"modal",5,6),e.\u0275\u0275element(7,"modal-header"),e.\u0275\u0275elementStart(8,"modal-content")(9,"div",7)(10,"b")(11,"label"),e.\u0275\u0275text(12,"Elige una foto:"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(13,"app-image-croper",null,8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"modal-footer")(16,"div",9)(17,"button",10),e.\u0275\u0275listener("click",function(){return r.closeUploadFileModal(!1)}),e.\u0275\u0275i18n(18,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",12),e.\u0275\u0275listener("click",function(){return r.uploadPhoto()}),e.\u0275\u0275i18n(20,13),e.\u0275\u0275elementEnd()()()()),2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!r.carregant),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.carregant),e.\u0275\u0275advance(15),e.\u0275\u0275property("disabled",!r.main.getCroppedImageBase64()))},dependencies:[F.r,O.NgIf,c._Y,c.Fj,c.JJ,c.JL,c.nD,c.sg,c.u,S.N,P.T,s.zS,s.YI,s.Ef,s.Rb],styles:[".content[_ngcontent-%COMP%]{max-width:940px;padding:100px 0;border:none}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:40px}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]{text-align:center}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:cover;padding:0;margin-bottom:10px;border:none;border-radius:10000px;overflow:hidden;position:relative}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:after{content:attr(data-content);font-size:20px;line-height:150px;color:#fff;position:absolute;width:100%;height:100%;top:0;left:0;background-color:#0008;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);opacity:0;border-radius:10000px;transition:all .2s}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:hover:after{opacity:1}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{width:inherit;border-radius:160px;max-width:100%;max-height:100%;object-fit:cover;border:50px;pointer-events:none}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:0;padding:7px 0}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .form-camp[_ngcontent-%COMP%]{padding:6px 12px;border-width:1px;border-radius:20px}.carregant[_ngcontent-%COMP%]   app-loading[_ngcontent-%COMP%]{margin:100px auto}  .uploadFileModal .modal-header{background-color:#292828;border-bottom:none}  .uploadFileModal .modal-header button{border:none;background-color:#292828}  .uploadFileModal .modal-content{background-color:#292828;border:3px solid white;padding:30px}  .uploadFileModal .modal-content #label{display:flex;justify-content:center;width:100%}  .uploadFileModal .modal-content #label label{font-size:25px;font-family:Roboto,sans-serif}  .uploadFileModal .modal-footer{margin:30px}  .uploadFileModal .modal-footer button{font-weight:700}  .uploadFileModal .modal-footer button:first-child{background-color:#292828;color:#fff;font-weight:700}@media (max-width: 667px){  .uploadFileModal .modal-footer{display:flex;justify-content:space-around}}@media (max-width: 500px){  .uploadFileModal .modal-footer{display:flex}  .uploadFileModal .modal-footer button{width:100%;margin:10px}}@media (max-width: 400px){  .uploadFileModal .modal-footer{width:auto;display:flex;justify-content:center;align-items:center}  .uploadFileModal .modal-footer button{width:100%;margin:10px}}"]}),l})();var A=i(4270);const V=[{path:"",children:[{path:"",component:B}]}];let j=(()=>{class l{}return l.\u0275fac=function(o){return new(o||l)},l.\u0275mod=e.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=e.\u0275\u0275defineInjector({imports:[A.Bz.forChild(V),A.Bz]}),l})();var k=i(9806);let W=(()=>{class l{}return l.\u0275fac=function(o){return new(o||l)},l.\u0275mod=e.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=e.\u0275\u0275defineInjector({imports:[j,k.z,O.CommonModule,t.m,c.u5,s.zk]}),l})()}}]);