"use strict";(self.webpackChunkWebAppNew=self.webpackChunkWebAppNew||[]).push([[582],{5219:(y,R,i)=>{i.d(R,{T:()=>A});var F=i(5861),o=i(4650),p=i(6345),M=i(6895);function S(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275i18n(1,3),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275i18nExp(n.text||n.nomText+" is required"),o.\u0275\u0275i18nApply(1)}}function P(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275i18n(1,4),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275i18nExp(n.nomText)(n.control.errors.minlength.actualLength)(null==n.control.errors?null:n.control.errors.minlength.requiredLength),o.\u0275\u0275i18nApply(1)}}function N(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275i18n(1,5),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275i18nExp(n.nomText)(n.control.errors.maxlength.actualLength)(null==n.control.errors?null:n.control.errors.maxlength.requiredLength),o.\u0275\u0275i18nApply(1)}}function O(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275i18n(1,6),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275i18nExp(n.nomText),o.\u0275\u0275i18nApply(1)}}function v(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275text(1),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275textInterpolate1("",n.nomText," already exists")}}function h(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div",2),o.\u0275\u0275i18n(1,7),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext(2);o.\u0275\u0275advance(1),o.\u0275\u0275i18nExp(n.nomText),o.\u0275\u0275i18nApply(1)}}function e(r,d){if(1&r&&(o.\u0275\u0275elementStart(0,"div"),o.\u0275\u0275template(1,S,2,1,"div",1),o.\u0275\u0275template(2,P,2,3,"div",1),o.\u0275\u0275template(3,N,2,3,"div",1),o.\u0275\u0275template(4,O,2,1,"div",1),o.\u0275\u0275template(5,v,2,1,"div",1),o.\u0275\u0275template(6,h,2,1,"div",1),o.\u0275\u0275elementEnd()),2&r){const n=o.\u0275\u0275nextContext();o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.required),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.minlength),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.maxlength),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.email),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.notUnique),o.\u0275\u0275advance(1),o.\u0275\u0275property("ngIf",null==n.control.errors?null:n.control.errors.pattern)}}let A=(()=>{class r{constructor(n){this.main=n}ngOnInit(){var n=this;return(0,F.Z)(function*(){console.log("Control: ",n.control)})()}}return r.\u0275fac=function(n){return new(n||r)(o.\u0275\u0275directiveInject(p.J))},r.\u0275cmp=o.\u0275\u0275defineComponent({type:r,selectors:[["app-missatge-error-form"]],inputs:{control:"control",text:"text",nomText:"nomText"},decls:1,vars:1,consts:function(){let d,n,g,I,C;return d="{{text || nomText + \" es obligatorio\"}}",n="" + "\ufffd0\ufffd" + " es demasiado corto (" + "\ufffd1\ufffd" + "/" + "\ufffd2\ufffd" + ")",g="" + "\ufffd0\ufffd" + " es demasiado largo (" + "\ufffd1\ufffd" + "/" + "\ufffd2\ufffd" + ")",I="" + "\ufffd0\ufffd" + " tiene un formato incorrecto.",C="" + "\ufffd0\ufffd" + " tiene un formato incorrecto.",[[4,"ngIf"],["class","textErrorForm",4,"ngIf"],[1,"textErrorForm"],d,n,g,I,C]},template:function(n,g){1&n&&o.\u0275\u0275template(0,e,7,6,"div",0),2&n&&o.\u0275\u0275property("ngIf",null==g.control?null:g.control.touched)},dependencies:[M.NgIf]}),r})()},5582:(y,R,i)=>{i.r(R),i.d(R,{EditProfileModule:()=>B});var F=i(6895),o=i(1670),p=i(4006),M=i(5861),S=i(1274),P=i(5009),N=i(4756),O=i(872),v=i(4004),h=i(7873),e=i(4650),A=i(6345),r=i(7753),d=i(1481),n=i(9653),g=i(8291),I=i(6362),C=i(5219);const T=["uploadFileModal"],L=["imageCropper"];function $(_,c){if(1&_){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",37),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.removePhoto())}),e.\u0275\u0275i18n(1,38),e.\u0275\u0275elementEnd()}}function D(_,c){if(1&_){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",14)(1,"div",15)(2,"button",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.openUploadFileModal())}),e.\u0275\u0275element(3,"video",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"br"),e.\u0275\u0275template(5,$,2,0,"button",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",19)(7,"label",20),e.\u0275\u0275i18n(8,21),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"input",22)(10,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",19)(12,"label",24),e.\u0275\u0275i18n(13,25),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"input",26)(15,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",19)(17,"label",24),e.\u0275\u0275i18n(18,27),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"input",28)(20,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",19)(22,"label",24),e.\u0275\u0275i18n(23,29),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"input",30)(25,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",19)(27,"label",24),e.\u0275\u0275i18n(28,31),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(29,"input",32)(30,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"div",19)(32,"label",24),e.\u0275\u0275i18n(33,33),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",34)(35,"app-missatge-error-form",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",35)(37,"input",36),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.submit())}),e.\u0275\u0275elementEnd()()()}if(2&_){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(3),e.\u0275\u0275property("src",t.form.controls.photo.value,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.form.controls.photo.value),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.name.value)("nomText","name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.lastName.value)("nomText","last name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.bio.value)("nomText","bio"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.email.value)("nomText","email"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.username.value)("nomText","username"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",t.form.controls.web.value)("nomText","website"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",t.carregantSave)}}function G(_,c){1&_&&(e.\u0275\u0275elementStart(0,"div",39),e.\u0275\u0275element(1,"app-loading"),e.\u0275\u0275elementEnd())}let w=(()=>{class _{constructor(t,l,a,s,E){this.main=t,this.fb=l,this.modalService=a,this.domSanitizer=s,this.store=E,this.files=[],this.validate=!1,this.fotoModificada=!1,this.mostrarFileRequired=!1,t.newPage(this),this.form=this.fb.group({id:[""],photo:[""],name:[""],lastName:[""],bio:[""],email:[""],username:[""],phone:[""],address:[""],web:[""]}),this.$user=this.store.select(h.dy).pipe((0,v.U)(m=>m.user)),this.$user.subscribe(m=>{this.ownUser=m})}ngOnInit(){var t=this;return(0,M.Z)(function*(){console.log("Own user: ",t.ownUser.userId);let l=t.ownUser.userId;t.carregant=!0;try{const a=yield P.Iw.getById(l),s=t.ownUser;console.log("Usuari edit-profile:",a.data),console.log("log user: ",s),console.log("Photo: ",O.pz.getUrlImageThumbnail({pictureId:s.photo,id:s.userId})),t.form.controls.photo.setValue(O.pz.getUrlImageThumbnail({pictureId:s.photo,id:s.userId})),t.form.controls.name.setValue(a.data.name||""),t.form.controls.username.setValue(s.nickname||"")}catch(a){console.error("Error al obtener los datos del usuario:",a)}finally{t.carregant=!1}})()}ngOnDestroy(){this.closeUploadFileModal(!1),this.main.onDestroyPage()}uploadPhoto(){var t=this;return(0,M.Z)(function*(){try{const l=t.main.getCroppedImageBase64(),m={fileExt:l.split(";")[0].split(":")[1].split("/")[1],dataBase64:l};yield O.pz.post(m).then(u=>{u.IsOk?console.log("OK. Message:",u):console.error("Error. Message:",u)})}catch(l){console.error("Error:",l)}})()}openUploadFileModal(){this.modalService.open(this.uploadFileModal,{size:"lg",modalClass:"uploadFileModal",backdropClass:"modal-backdrop",hideCloseButton:!1,centered:!0,backdrop:!0,animation:!0,keyboard:!0,closeOnOutsideClick:!1})}closeUploadFileModal(t){t&&(this.form.controls.photo.setValue(this.imageCropper.croppedImage),this.fotoModificada=!0),this.modalService.close(this.uploadFileModal)}removePhoto(){this.form.controls.photo.setValue(null),this.imageCropper.removePhoto(),this.fotoModificada=!0}submit(){var t=this;return(0,M.Z)(function*(){if(t.form.markAllAsTouched(),t.mostrarFileRequired=!S.c.objPle(t.files),!t.form.valid)return console.log("--- INV\xc0LID ---"),void console.log("Form error!: ",t.form);const l=new FormData;let a;if(t.fotoModificada){var s=t.imageCropper.croppedImage;a={dataBase64:s.substr(s.indexOf("base64,")+7),fileName:"userProfile",fileExt:t.main.getStringBetween(s,"data:image/",";base64,")},console.log(a)}l.append("name",t.form.controls.name.value),l.append("lastName",t.form.controls.lastName.value),l.append("bio",t.form.controls.bio.value),l.append("phone",t.form.controls.phone.value),l.append("address",t.form.controls.address.value),l.append("web",t.form.controls.web.value);let E=new P.Iw({photo:a||null,name:t.form.controls.name.value||null,nickname:t.form.controls.username.value||null});console.log("allNewInfo: ",E);try{yield P.Iw.put(E).then(function(){var m=(0,M.Z)(function*(u){u.IsOk?(console.log("OK. Message:",u),yield N.Pe.newCurrentUser(),t.main.toastSuccess("Les dades s'han canviat correctament"),t.main.goToProfile()):(console.error("Error. Message:",u),t.main.toastDanger("No s'ha pogut canviar les teves dades"))});return function(u){return m.apply(this,arguments)}}())}catch(m){console.error("Error:",m)}t.carregantSave=!0})()}}return _.\u0275fac=function(t){return new(t||_)(e.\u0275\u0275directiveInject(A.J),e.\u0275\u0275directiveInject(p.qu),e.\u0275\u0275directiveInject(r.gk),e.\u0275\u0275directiveInject(d.H7),e.\u0275\u0275directiveInject(n.yh))},_.\u0275cmp=e.\u0275\u0275defineComponent({type:_,selectors:[["app-edit-profile"]],viewQuery:function(t,l){if(1&t&&(e.\u0275\u0275viewQuery(T,5),e.\u0275\u0275viewQuery(L,5)),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(l.uploadFileModal=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(l.imageCropper=a.first)}},decls:21,vars:3,consts:function(){let c,t,l,a,s,E,m,u,b;return c="Cerrar",t="Guardar",l="Nombre",a="Apellidos",s="Biograf\xEDa",E="Correo electr\xF3nico",m="Nombre de usuario",u="P\xE1gina web",b="Elimina foto",[[1,"content"],[1,"card"],[1,"card-body"],["class","theme-form",3,"formGroup",4,"ngIf"],["class","carregant",4,"ngIf"],["id","uploadFileModal",1,"uploadFileModal"],["uploadFileModal",""],["id","label"],["imageCropper",""],["id","buttons"],[1,"boto","botoPrincipal","botoGran",3,"click"],c,[1,"boto","botoPrincipal","botoGran",3,"disabled","click"],t,[1,"theme-form",3,"formGroup"],[1,"divBotoFoto","form-grup"],["data-content","Change photo",1,"botoFoto",3,"click"],[1,"foto",3,"src"],["class","boto botoVermell botoPetit removePhoto",3,"click",4,"ngIf"],[1,"form-grup","row","no-gutters"],[1,"col-form-label","col-sm-12","col-xl-3","asterisc"],l,["type","text","formControlName","name",1,"form-camp","col-sm-12","col-xl-9"],[3,"control","nomText"],[1,"col-form-label","col-sm-12","col-xl-3"],a,["type","text","formControlName","lastName",1,"form-camp","col-sm-12","col-xl-9"],s,["type","text","maxlength","3000","formControlName","bio",1,"form-camp","col-sm-12","col-xl-9"],E,["type","text","formControlName","email",1,"form-camp","col-sm-12","col-xl-9"],m,["type","text","formControlName","username",1,"form-camp","col-sm-12","col-xl-9"],u,["type","text","formControlName","web",1,"form-camp","col-sm-12","col-xl-9"],[2,"text-align","center"],["type","button","value","Save",1,"boto","botoPrincipal","botoGran",3,"disabled","click"],[1,"boto","botoVermell","botoPetit","removePhoto",3,"click"],b,[1,"carregant"]]},template:function(t,l){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,D,38,16,"form",3),e.\u0275\u0275template(4,G,2,0,"div",4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"modal",5,6),e.\u0275\u0275element(7,"modal-header"),e.\u0275\u0275elementStart(8,"modal-content")(9,"div",7)(10,"b")(11,"label"),e.\u0275\u0275text(12,"Elige una foto:"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(13,"app-image-croper",null,8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"modal-footer")(16,"div",9)(17,"button",10),e.\u0275\u0275listener("click",function(){return l.closeUploadFileModal(!1)}),e.\u0275\u0275i18n(18,11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",12),e.\u0275\u0275listener("click",function(){return l.uploadPhoto()}),e.\u0275\u0275i18n(20,13),e.\u0275\u0275elementEnd()()()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!l.carregant),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",l.carregant),e.\u0275\u0275advance(15),e.\u0275\u0275property("disabled",!l.main.getCroppedImageBase64()))},dependencies:[g.r,F.NgIf,p._Y,p.Fj,p.JJ,p.JL,p.nD,p.sg,p.u,I.N,C.T,r.zS,r.YI,r.Ef,r.Rb],styles:[".content[_ngcontent-%COMP%]{max-width:940px;padding:100px 0;border:none}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:40px}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]{text-align:center}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:cover;padding:0;margin-bottom:10px;border:none;border-radius:10000px;overflow:hidden;position:relative}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:after{content:attr(data-content);font-size:20px;line-height:150px;color:#fff;position:absolute;width:100%;height:100%;top:0;left:0;background-color:#0008;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);opacity:0;border-radius:10000px;transition:all .2s}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:hover:after{opacity:1}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{width:inherit;border-radius:160px;max-width:100%;max-height:100%;object-fit:cover;border:50px;pointer-events:none}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:0;padding:7px 0}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .form-camp[_ngcontent-%COMP%]{padding:6px 12px;border-width:1px;border-radius:20px}.carregant[_ngcontent-%COMP%]   app-loading[_ngcontent-%COMP%]{margin:100px auto}  .uploadFileModal .modal-header{background-color:#292828;border-bottom:none}  .uploadFileModal .modal-header button{border:none;background-color:#292828}  .uploadFileModal .modal-content{background-color:#292828;border:3px solid white;padding:30px}  .uploadFileModal .modal-content #label{display:flex;justify-content:center;width:100%}  .uploadFileModal .modal-content #label label{font-size:25px;font-family:Roboto,sans-serif}  .uploadFileModal .modal-footer{margin:30px}  .uploadFileModal .modal-footer button{font-weight:700}  .uploadFileModal .modal-footer button:first-child{background-color:#292828;color:#fff;font-weight:700}@media (max-width: 667px){  .uploadFileModal .modal-footer{display:flex;justify-content:space-around}}@media (max-width: 500px){  .uploadFileModal .modal-footer{display:flex}  .uploadFileModal .modal-footer button{width:100%;margin:10px}}@media (max-width: 400px){  .uploadFileModal .modal-footer{width:auto;display:flex;justify-content:center;align-items:center}  .uploadFileModal .modal-footer button{width:100%;margin:10px}}"]}),_})();var x=i(4270);const z=[{path:"",children:[{path:"",component:w}]}];let X=(()=>{class _{}return _.\u0275fac=function(t){return new(t||_)},_.\u0275mod=e.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=e.\u0275\u0275defineInjector({imports:[x.Bz.forChild(z),x.Bz]}),_})();var U=i(9806);let B=(()=>{class _{}return _.\u0275fac=function(t){return new(t||_)},_.\u0275mod=e.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=e.\u0275\u0275defineInjector({imports:[X,U.z,F.CommonModule,o.m,p.u5,r.zk]}),_})()}}]);