"use strict";(self.webpackChunkWebAppNew=self.webpackChunkWebAppNew||[]).push([[582],{5582:(z,u,l)=>{l.r(u),l.d(u,{EditProfileModule:()=>V});var E=l(6895),M=l(4065),i=l(4006),f=l(5861),P=l(1274),O=l(999),g=l(4596),v=l(3769),R=l(2613),e=l(4650),h=l(6345),_=l(7753),S=l(1481),N=l(8291),A=l(6362),b=l(5219);const F=["uploadFileModal"],L=["imageCropper"];function y(n,a){if(1&n){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",34),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.removePhoto())}),e.\u0275\u0275i18n(1,35),e.\u0275\u0275elementEnd()}}function x(n,a){if(1&n){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",12)(1,"div",13)(2,"button",14),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.openUploadFileModal())}),e.\u0275\u0275element(3,"img",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"br"),e.\u0275\u0275template(5,y,2,0,"button",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",17)(7,"label",18),e.\u0275\u0275i18n(8,19),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"input",20)(10,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",17)(12,"label",18),e.\u0275\u0275i18n(13,22),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"input",23)(15,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",17)(17,"label",18),e.\u0275\u0275i18n(18,24),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"input",25)(20,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",17)(22,"label",18),e.\u0275\u0275i18n(23,26),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"input",27)(25,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",17)(27,"label",18),e.\u0275\u0275i18n(28,28),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(29,"input",29)(30,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"div",17)(32,"label",18),e.\u0275\u0275i18n(33,30),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",31)(35,"app-missatge-error-form",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",32)(37,"input",33),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.submit())}),e.\u0275\u0275elementEnd()()()}if(2&n){const o=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",o.form),e.\u0275\u0275advance(3),e.\u0275\u0275property("src",o.form.controls.photo.value,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.form.controls.photo.value),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.name.value)("nomText","name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.lastName.value)("nomText","last name"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.bio.value)("nomText","bio"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.email.value)("nomText","email"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.username.value)("nomText","username"),e.\u0275\u0275advance(5),e.\u0275\u0275property("control",o.form.controls.web.value)("nomText","website"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",o.carregantSave)}}function $(n,a){1&n&&(e.\u0275\u0275elementStart(0,"div",36),e.\u0275\u0275element(1,"app-loading"),e.\u0275\u0275elementEnd())}let G=(()=>{class n{constructor(o,t,r,m){this.main=o,this.fb=t,this.modalService=r,this.domSanitizer=m,this.files=[],this.validate=!1,this.fotoModificada=!1,this.mostrarFileRequired=!1,o.newPage(this),this.form=this.fb.group({id:[""],photo:[""],name:[""],lastName:[""],bio:[""],email:[""],username:[""],phone:[""],address:[""],web:[""]})}ngOnInit(){var o=this;return(0,f.Z)(function*(){o.carregant=!0;let t=yield O.P.getLoginInfo().then(r=>r.result);o.carregant=!1,o.form.controls.photo.setValue(P.c.prependImagesUrl(o.main.apiHelpers.currentUser?.photo)),o.form.controls.name.setValue(o.main.apiHelpers.currentUser?.name),o.form.controls.lastName.setValue(o.main.apiHelpers.currentUser?.lastName),o.form.controls.bio.setValue(t?.bio||""),o.form.controls.email.setValue(o.main.apiHelpers.currentUser?.email||""),o.form.controls.username.setValue(o.main.apiHelpers.currentUser?.nickname||""),o.form.controls.phone.setValue(t?.phone||""),o.form.controls.address.setValue(t?.address||""),o.form.controls.web.setValue(t?.web||""),o.form.controls.email.disable()})()}ngOnDestroy(){this.closeUploadFileModal(!1),this.main.onDestroyPage()}openUploadFileModal(){this.modalService.open(this.uploadFileModal,{size:"lg",modalClass:"uploadFileModal",backdropClass:"modal-backdrop",hideCloseButton:!1,centered:!0,backdrop:!0,animation:!0,keyboard:!0,closeOnOutsideClick:!1})}closeUploadFileModal(o){o&&(this.form.controls.photo.setValue(this.imageCropper.croppedImage),this.fotoModificada=!0),this.modalService.close(this.uploadFileModal)}removePhoto(){this.form.controls.photo.setValue(null),this.imageCropper.removePhoto(),this.fotoModificada=!0}profileIncorrecte(){return(this.form.controls.profile1.touched||this.form.controls.profile2.touched||this.form.controls.profile3.touched||this.form.controls.profile4.touched)&&!(this.form.controls.profile1.value||this.form.controls.profile2.value||this.form.controls.profile3.value||this.form.controls.profile4.value)}submit(){var o=this;return(0,f.Z)(function*(){o.form.markAllAsTouched(),o.mostrarFileRequired=!P.c.objPle(o.files);const t=new FormData;let r;if(o.fotoModificada){var m=o.imageCropper.croppedImage;r={dataBase64:m.substr(m.indexOf("base64,")+7),fileName:"userProfile",fileExt:o.main.getStringBetween(m,"data:image/",";base64,")},console.log(r)}t.append("name",o.form.controls.name.value),t.append("lastName",o.form.controls.lastName.value),t.append("bio",o.form.controls.bio.value),t.append("phone",o.form.controls.phone.value),t.append("address",o.form.controls.address.value),t.append("web",o.form.controls.web.value);let c=new g.Iw({userProfileId:o.main.apiHelpers.currentUser.userProfileId||null,nickname:o.form.controls.username.value||null,photo:r||null,photoId:null,phone:o.form.controls.phone.value||null,color:null,profileTypeId:null,name:o.form.controls.name.value||null,website:o.form.controls.web.value||null,languages:[new g.Aq({biography:o.form.controls.bio.value||null,languageId:yield R.I.getLanguageIdByName(o.main.getLocale())})]});console.log("allNewInfo: ",c),c.check().size>0?console.log(c.check()):(v.J.updateProfile(c).then(function(){var d=(0,f.Z)(function*(p){200==p.status&&(yield o.main.apiHelpers.newCurrentUser(),o.main.toastSuccess("Profile modified successfully"),o.main.goTo("/profile"))});return function(p){return d.apply(this,arguments)}}()).catch(d=>{console.log(d)}),o.carregantSave=!0)})()}}return n.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(h.J),e.\u0275\u0275directiveInject(i.qu),e.\u0275\u0275directiveInject(_.gk),e.\u0275\u0275directiveInject(S.H7))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-edit-profile"]],viewQuery:function(o,t){if(1&o&&(e.\u0275\u0275viewQuery(F,5),e.\u0275\u0275viewQuery(L,5)),2&o){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.uploadFileModal=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.imageCropper=r.first)}},decls:17,vars:2,consts:function(){let a,o,t,r,m,c,d,p,C,T;return a="Subir foto",o="Cerrar",t="Guardar",r="Nombre",m="Apellidos",c="Biograf\xEDa",d="Correo electr\xF3nico",p="Nombre de usuario",C="P\xE1gina web",T="Elimina foto",[[1,"content"],[1,"card"],[1,"card-body"],["class","theme-form",3,"formGroup",4,"ngIf"],["class","carregant",4,"ngIf"],["id","uploadFileModal",1,"uploadFileModal"],["uploadFileModal",""],a,["imageCropper",""],[1,"boto","botoPrincipal","botoGran",3,"click"],o,t,[1,"theme-form",3,"formGroup"],[1,"divBotoFoto","form-grup"],["data-content","Change photo",1,"botoFoto",3,"click"],["alt","profile photo",1,"foto",3,"src"],["class","boto botoVermell botoPetit removePhoto",3,"click",4,"ngIf"],[1,"form-grup","row","no-gutters"],[1,"col-form-label","col-sm-12","col-xl-3"],r,["type","text","formControlName","name",1,"form-camp","col-sm-12","col-xl-9"],[3,"control","nomText"],m,["type","text","formControlName","lastName",1,"form-camp","col-sm-12","col-xl-9"],c,["type","text","maxlength","3000","formControlName","bio",1,"form-camp","col-sm-12","col-xl-9"],d,["type","text","formControlName","email",1,"form-camp","col-sm-12","col-xl-9"],p,["type","text","formControlName","username",1,"form-camp","col-sm-12","col-xl-9"],C,["type","text","formControlName","web",1,"form-camp","col-sm-12","col-xl-9"],[2,"text-align","center"],["type","button","value","Save",1,"boto","botoPrincipal","botoGran",3,"disabled","click"],[1,"boto","botoVermell","botoPetit","removePhoto",3,"click"],T,[1,"carregant"]]},template:function(o,t){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,x,38,16,"form",3),e.\u0275\u0275template(4,$,2,0,"div",4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"modal",5,6)(7,"modal-header"),e.\u0275\u0275i18n(8,7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"modal-content"),e.\u0275\u0275element(10,"app-image-croper",null,8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"modal-footer")(13,"button",9),e.\u0275\u0275listener("click",function(){return t.closeUploadFileModal(!1)}),e.\u0275\u0275i18n(14,10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",9),e.\u0275\u0275listener("click",function(){return t.closeUploadFileModal(!0)}),e.\u0275\u0275i18n(16,11),e.\u0275\u0275elementEnd()()()),2&o&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!t.carregant),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.carregant))},dependencies:[N.r,E.NgIf,i._Y,i.Fj,i.JJ,i.JL,i.nD,i.sg,i.u,A.N,b.T,_.zS,_.YI,_.Ef,_.Rb],styles:[".content[_ngcontent-%COMP%]{max-width:940px;padding:100px 0;border:none}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:40px}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]{text-align:center}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:cover;padding:0;margin-bottom:10px;border:none;border-radius:10000px;overflow:hidden;position:relative}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:after{content:attr(data-content);font-size:20px;line-height:150px;color:#fff;position:absolute;width:100%;height:100%;top:0;left:0;background-color:#0008;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);opacity:0;border-radius:10000px;transition:all .2s}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]:hover:after{opacity:1}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .divBotoFoto[_ngcontent-%COMP%]   button.botoFoto[_ngcontent-%COMP%]   img.foto[_ngcontent-%COMP%]{width:150px;height:150px}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:0;padding:7px 0}.content[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grup[_ngcontent-%COMP%]   .form-camp[_ngcontent-%COMP%]{padding:6px 12px;border-width:1px;border-radius:20px}.carregant[_ngcontent-%COMP%]   app-loading[_ngcontent-%COMP%]{margin:100px auto}"]}),n})();var I=l(6272);const D=[{path:"",children:[{path:"",component:G}]}];let w=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[I.Bz.forChild(D),I.Bz]}),n})();var U=l(9806);let V=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[w,U.z,E.CommonModule,M.m,i.u5,_.zk]}),n})()}}]);